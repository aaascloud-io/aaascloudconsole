<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-header row mb-1"></div>
    <div class="content-detached">
      <div class="content-body">
        <div>
          <label for="switch">条件検索：</label>
          <input id="switch" name="switch" type="checkbox" [(ngModel)]="showSearch" />
        </div>
        <section class="row" *ngIf="showSearch">
          <div class="col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-3">
                      <div class="form-group">
                        <label for="">会社名</label>
                        <input type="text" class="form-control" id="" placeholder=""
                          [(ngModel)]="pageModel.query.companyname">
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="form-group">
                        <label for="">ユーザー姓</label>
                        <input type="text" class="form-control" id="" placeholder=""
                          [(ngModel)]="pageModel.query.lastname">
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="form-group">
                        <label for="">ユーザー名</label>
                        <input type="text" class="form-control" id="" placeholder=""
                          [(ngModel)]="pageModel.query.firstname">
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group">
                        <label for="">メールー</label>
                        <input type="text" class="form-control" id="" placeholder=""
                          [(ngModel)]="pageModel.query.email">
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="heading-elements mt-0 pull-right" style="padding-top:20px;">
                          <button class="btn btn-primary btn-sm gap_contact" (click)="searchMyUsers()">
                            <i class="d-md-none d-block feather ft-plus white"></i>
                            <span class="d-md-block d-none">検　索</span></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <div class="row">
          <div class="col-sm-12">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-sm-12">
                    <button class="btn btn-primary btn-sm gap_contact"
                      (click)="addTableDataModal(addTableDataModalContent)">
                      <i class="d-md-none d-block feather ft-plus white"></i>
                      <span class="d-md-block d-none">新　規</span></button>
                    <button class="btn btn-danger btn-sm gap_contact" style="margin-left:5px"
                      (click)="deleteCheckedRow()">
                      <i class="d-md-none d-block feather ft-plus white"></i>
                      <span class="d-md-block d-none">削　除</span></button>
                  </div>
                </div>
              </div>
              <div class="table-responsive card-body">
                <table class="table grid-breakpoints">
                  <thead>
                    <tr>
                      <th scope="col" class="thcolor"><input type="checkbox" [checked]="isAllChecked()"
                          (change)="checkAll($event)">
                      </th>
                      <th scope="col" class="thcolor">No.</th>
                      <th scope="col" class="thcolor" (click)="sortData('companyName')">会社名</th>
                      <th scope="col" class="thcolor" (click)="sortData('name')">ユーザー姓名</th>
                      <th scope="col" class="thcolor" (click)="sortData('email')">メール</th>
                      <th scope="col" class="thcolor" (click)="sortData('username')">ログインID</th>
                      <th scope="col" class="thcolor" (click)="sortData('address')">住所</th>
                      <th scope="col" class="thcolor" (click)="sortData('userCount')">ユーザー数</th>
                      <th scope="col" class="thcolor" (click)="sortData('devicecount')">デバイス数</th>
                      <th scope="col" class="thcolor">操作</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let element of PaginationData;let i = index">
                      <td>
                        <input type="checkbox" [checked]="element.isSelected" (change)="checkChange($event,element)">
                      </td>
                      <td>{{i+1}}</td>
                      <td>{{ element.companyName }}</td>
                      <td>{{ element.name}}</td>
                      <td>{{ element.email }}</td>
                      <td>{{ element.username }}</td>
                      <td>{{ element.address}}</td>
                      <td>{{ element.userCount}}</td>
                      <td>{{ element.devicecount}}</td>
                      <td>
                        <a [routerLink]="" class="primary edit mr-1 mrless"
                          (click)="editTableDataModal(editTableDataModalContent, element)"><i class="la la-pencil"></i>
                        </a>
                        <a class="danger delete mr-1 mrless"><i class="la la-trash-o"
                            (click)="deleteRow(element)"></i></a>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div class="d-flex justify-content-between p-2">
                  <ngb-pagination [collectionSize]="collectionSize" [(page)]="page" [pageSize]="pageSize">
                  </ngb-pagination>
                  <select class="custom-select" style="width: auto" [(ngModel)]="pageSize">
                    <option [ngValue]="10">10 items per page</option>
                    <option [ngValue]="20">20 items per page</option>
                    <option [ngValue]="50">50 items per page</option>
                    <option [ngValue]="100">100 items per page</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer">
  <span *ngIf="pageModel.result.retcode =='0000'" style="color:blue">{{pageModel.result.retcode}}　{{pageModel.result.message}}</span>
  <span *ngIf="pageModel.result.retcode !='0000'" class="text-danger">{{pageModel.result.retcode}}　{{pageModel.result.message}}</span>
</div>


<ng-template #editTableDataModalContent let-c="close" let-d="dismiss">
  <form (ngSubmit)="onUpdate(editUpdateForm)" #editUpdateForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">編集</h5>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="form-group col-lg-6 col-md-12">
          <h6>ログインID<code>＊</code></h6>
          <input type="text" [(ngModel)]="selectedContact.username" #editusername="ngModel" name="username"
            id="username" class="name form-control" placeholder="ユーザー名" disabled maxlength="50">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>ユーザー姓名<code>＊</code></h6>
          <input type="text" [(ngModel)]="selectedContact.name" #editname="ngModel" name="name" id="name"
            class="name form-control" placeholder="" disabled maxlength="50">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>権限<code>＊</code></h6>
          <select class="form-control" id="role" name="role" [(ngModel)]="selectedContact.role" #editrole="ngModel"
            class="name form-control">
            <option [value]=1>管理者</option>
            <option [value]=2>使用者</option>
          </select>
        </div>
        <div class="form-group col-lg-6 col-md-12">

        </div>
        <div class="form-group col-lg-12 col-md-12">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>会社名<code>＊</code></h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.companyname" #editcompanyname="ngModel"
            name="companyname" id="companyname" class="name form-control" placeholder="会社名" maxlength="50">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>法人番号<code>＊</code></h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.corporatenumber" #editcorporatenumber="ngModel"
            name="corporatenumber" id="corporatenumber" class="name form-control" placeholder="法人番号" maxlength="13">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>住所</h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.address" #editaddress="ngModel" name="address"
            id="address" class="name form-control" placeholder="アドレス" maxlength="100">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>業種</h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.industry" #editindustry="ngModel" name="industry"
            id="industry" class="name form-control" placeholder="業種" maxlength="50">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>メール</h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.mail" #editmail="ngModel" name="mail" id="mail"
            class="name form-control" placeholder="メール" maxlength="50">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>電話</h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.tel" #edittel="ngModel" name="tel" id="tel"
            class="name form-control" placeholder="電話" maxlength="13">
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>Fax</h6>
          <input type="text" [(ngModel)]="pageModel.updataUserInfo.fax" #editfax="ngModel" name="fax" id="fax"
            class="name form-control" placeholder="Fax" maxlength="13">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="form-group position-relative has-icon-left mb-0">
        <button type="submit" class="btn btn-secondary cancel-btn mr-1" (click)="cancleModel(editUpdateForm)">
          <span class="d-sm-inline d-none">取消</span>
        </button>
      </div>
      <div class="form-group position-relative has-icon-left mb-0">
        <button type="submit" id="edit-contact-item" class="btn btn-info edit-contact-item" data-dismiss="modal"><i
            class="la la-paper-plane-o d-lg-none"></i> <span class="d-none d-lg-block">保存</span></button>
      </div>
      <!-- <div class="footer">
        <span *ngIf="pageModel.result.retcode =='0000'" style="color:blue">{{pageModel.result.retcode}}　{{pageModel.result.message}}</span>
        <span *ngIf="pageModel.result.retcode !='0000'" class="text-danger">{{pageModel.result.retcode}}　{{pageModel.result.message}}</span>
      </div> -->
    </div>
  </form>
</ng-template>
<ng-template #addTableDataModalContent let-c="close" let-d="dismiss">
  <!-- <form #editAddForm="ngForm"> -->
  <form #addForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">新規</h5>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="form-group col-lg-6 col-md-12">
          <h6>ユーザー名<code>＊</code></h6>
          <input type="text" [(ngModel)]="pageModel.adduserInfo.username" #editname="ngModel" name="username"
            id="username" class="name form-control" placeholder="半角英数で入力してください"
            [ngClass]="{ 'is-invalid': addForm.submitted && editname.invalid }" required>
          <div *ngIf="addForm.submitted && editname.invalid" class="invalid-feedback">
            <div *ngIf="editname.errors.required">ユーザー名を入力してください</div>
          </div>
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>権限<code>＊</code></h6>
          <select class="form-control" id="role" name="role" [(ngModel)]="pageModel.adduserInfo.role" #addrole="ngModel"
            class="name form-control" [ngClass]="{ 'is-invalid': addForm.submitted && addrole.invalid }" required>
            <option [value]=1>管理者</option>
            <option [value]=2>使用者</option>
          </select>
          <div *ngIf="addForm.submitted && addrole.invalid" class="invalid-feedback">
            <div *ngIf="addrole.errors.required">権限を選択してください</div>
          </div>
        </div>
        <div class="form-group col-lg-6 col-md-12">
          <h6>上位管理者<code>＊</code></h6>
          <select class="form-control" name="upperuser" id="upperuser" [(ngModel)]="pageModel.adduserInfo.upperuserid"
            placeholder="選択してください。" #editupperuser="ngModel"
            [ngClass]="{ 'is-invalid': addForm.submitted && editupperuser.invalid }" required>
            <option *ngFor="let user of rows; let i = index" [ngValue]="user.userid">
              {{user.name}}
            </option>
          </select>
          <div *ngIf="addForm.submitted && editupperuser.invalid" class="invalid-feedback">
            <div *ngIf="editupperuser.errors.required">権限を選択してください</div>
          </div>
        </div>

        <div class="form-group col-lg-12 col-md-12">
          <ul class="nav nav-tabs _bottom nav-underline no-hover-bg tabsborder">
            <ngb-tabset>
              <ngb-tab title="会社情報">
                <ng-template ngbTabContent>
                  <h4 class="form-section">会社情報</h4>
                  <div class="row">
                    <div class="form-group col-lg-6 col-md-12">
                      <h6 style="width: 410px;">会社名<code>＊</code></h6>
                      <select class="form-control" name="company" id="company"
                        [(ngModel)]="pageModel.adduserInfo.companyInfo.companyid" placeholder="選択してください。"
                        #editname="ngModel" (change)="show()"
                        [ngClass]="{ 'is-invalid': addForm.submitted && editname.invalid }" required>
                        <option *ngFor="let companyInfo of pageModel.companyInfoAll; let i = index"
                          [ngValue]="companyInfo.companyid">
                          {{companyInfo.companyname}}
                        </option>
                      </select>
                      <div *ngIf="addForm.submitted && editname.invalid" class="invalid-feedback">
                        <div *ngIf="editname.errors.required">ユーザータイプを選んでください</div>
                      </div>
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>法人番号<code>＊</code></h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.companyInfo.corporatenumber"
                        #editversion="ngModel" name="corporatenumber" id="corporatenumber" class="name form-control"
                        placeholder="法人番号" disabled maxlength="13">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>住所</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.companyInfo.address" #editversion="ngModel"
                        name="address" id="address" class="name form-control" placeholder="住所" disabled maxlength="100">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>業種</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.companyInfo.industry" #editversion="ngModel"
                        name="industry" id="industry" class="name form-control" placeholder="業種" disabled
                        maxlength="50">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>メール</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.companyInfo.mail" #editversion="ngModel"
                        name="mail" id="mail" class="name form-control" placeholder="メール" disabled maxlength="50">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>電話</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.companyInfo.tel" #editversion="ngModel"
                        name="tel" id="tel" class="name form-control" placeholder="電話" disabled maxlength="13">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>Fax</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.companyInfo.fax" #editversion="ngModel"
                        name="fax" id="fax" class="name form-control" placeholder="Fax" disabled maxlength="13">
                    </div>
                  </div>
                  <div class="modal-footer">
                    <div class="form-group position-relative has-icon-left mb-0">
                      <button type="reset" class="btn btn-secondary cancel-btn mr-1" (click)="cancleModel(addForm)">
                        <!-- <i class='ficon feather ft-x mr-25'></i> -->
                        <span class="d-sm-inline d-none">取消</span>
                      </button>
                    </div>
                    <div class="form-group position-relative has-icon-left mb-0">
                      <button type="submit" id="edit-contact-item" class="btn btn-info edit-contact-item"
                        data-dismiss="modal"><i class="la la-paper-plane-o d-lg-none"></i> <span
                          class="d-none d-lg-block" (click)="addCompUser(addForm)">登録</span></button>
                    </div>
                  </div>
                </ng-template>
              </ngb-tab>
              <ngb-tab title="新規会社">
                <ng-template ngbTabContent>
                  <h4 class="form-section">新規会社情報</h4>
                  <div class="row">
                    <div class="form-group col-lg-6 col-md-12">
                      <h6 style="width: 410px;">会社名<code>＊</code></h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.companyname"
                        #editname="ngModel" name="companyname" id="companyname" class="name form-control"
                        placeholder="会社名" [ngClass]="{ 'is-invalid': addForm.submitted && editname.invalid }" required>
                      <div *ngIf="addForm.submitted && editname.invalid" class="invalid-feedback">
                        <div *ngIf="editname.errors.required">会社名を入力してください</div>
                      </div>
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>法人番号<code>＊</code></h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.corporatenumber"
                        #addcorporatenumber="ngModel" name="corporatenumber" id="corporatenumber"
                        class="name form-control" placeholder="法人番号"
                        [ngClass]="{ 'is-invalid': addForm.submitted && addcorporatenumber.invalid }" required>
                      <div *ngIf="addForm.submitted && addcorporatenumber.invalid" class="invalid-feedback"
                        maxlength="13">
                        <div *ngIf="addcorporatenumber.errors.required">法人番号を入力してください</div>
                      </div>
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>住所</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.address"
                        #editversion="ngModel" name="address" id="address" class="name form-control" placeholder="住所"
                        maxlength="100">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>業種</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.industry"
                        #editversion="ngModel" name="industry" id="industry" class="name form-control" placeholder="業種"
                        maxlength="50">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>メール</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.mail" #editversion="ngModel"
                        name="mail" id="mail" class="name form-control" placeholder="メール" maxlength="50">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>電話</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.tel" #editversion="ngModel"
                        name="tel" id="tel" class="name form-control" placeholder="電話" maxlength="13">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                      <h6>Fax</h6>
                      <input type="text" [(ngModel)]="pageModel.adduserInfo.newCompanyInfo.fax" #editversion="ngModel"
                        name="fax" id="fax" class="name form-control" placeholder="Fax" maxlength="13">
                    </div>
                    <div class="form-group col-lg-6 col-md-12">
                    </div>
                  </div>
                  <div class="modal-footer">
                    <div class="form-group position-relative has-icon-left mb-0">
                      <button type="reset" class="btn btn-secondary cancel-btn mr-1" (click)="cancleModel(addForm)">
                        <!-- <i class='ficon feather ft-x mr-25'></i> -->
                        <span class="d-sm-inline d-none">取消</span>
                      </button>
                    </div>
                    <div class="form-group position-relative has-icon-right mb-0">
                      <button type="submit" id="edit-contact-item" class="btn btn-info edit-contact-item"
                        data-dismiss="modal" data-dismiss="modal"><span class="d-none d-lg-block"
                          (click)="addNewCompUser(addForm)" aria-label="Close">登録</span></button>
                    </div>
                  </div>
                </ng-template>
              </ngb-tab>
            </ngb-tabset>
          </ul>
        </div>
      </div>
    </div>
  </form>
</ng-template>