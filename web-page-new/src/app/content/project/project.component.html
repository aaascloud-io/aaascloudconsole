<div class="app-content content">
  <div class="content-wrapper">
    <div class="content-header row mb-1 ml-1"><h4>プロジェクト管理</h4></div>
    <div class=""> 
      <div class="content-body">
        <div class="content-overlay" id='content-overlay'></div>
        <section class="row">
          <div class="col-12">
            <div class="card">

              <div class="card-content">
                <div class="card-body">
                  <!-- Task List table -->
                  <div class="row">
                    <div class="col-sm-12">
                      <span class="mr-1">プロジェクト名：
                        <input type='text'
                        style='padding:8px;margin:15px auto;width:200px;height: calc(1.875rem + 2px);border-radius: 0.21rem;border: 1px solid #babfc7;' [(ngModel)]="searchValue"/>
                      </span>
                        <button type="button" class="btn btn-primary btn-sm mr-1" (click)="searchProject()">検　索</button>
                        <button type="button" class="btn btn-warning btn-sm mr-1" (click)="clearSearchProject()">クリア</button>

                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <button type="button" class="btn btn-primary btn-sm mb-2 mr-1" (click)="addNewProjectModal(addNewProject)">新  規</button>
                      <button type="button" class="btn btn-danger btn-sm mb-2 mr-1" (click)="deleteCheckedRow()">一括削除</button>
                    </div>
                  </div>

                  <ngx-datatable #table 
                    id ="ngxdatatable"
                    class="bootstrap row material" 
                    [rows]="rows" 
                    [columnMode]="'flex'" 
                    [headerHeight]="30"
                    [footerHeight]="50" 
                    [rowHeight]="60" 
                    [limit]="pageSize" 
                    [selected]="selected" 
                    [selectionType]="'checkbox'"
                    (select)='onSelectContact($event)' 
                    fxFlex="auto" 
                    [perfectScrollbar]="config">

                    <ngx-datatable-column 
                      [flexGrow]="1" 
                      [minWidth]="30" 
                      [maxWidth]="50">
                      <ng-template 
                        ngx-datatable-header-template 
                        let-value="value" 
                        let-allRowsSelected="allRowsSelected"
                        let-selectFn="selectFn">
                        <span class="custom-control custom-checkbox">
                          <input type="checkbox" 
                            class="custom-control-input" 
                            id="selectAll" 
                            [checked]="allRowsSelected"
                            (change)="selectFn(!allRowsSelected)" />
                          <label class="custom-control-label" for="selectAll"></label>
                        </span>
                      </ng-template>
                      <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex"
                        let-onCheckboxChangeFn="onCheckboxChangeFn" let-isSelected="isSelected">
                        <div class="custom-control custom-checkbox _center">
                          <input type="checkbox" class="custom-control-input" id="select{{rowIndex}}"
                            [checked]="isSelected" (change)="onCheckboxChangeFn($event)" />
                          <label class="custom-control-label" for="select{{rowIndex}}"></label>
                        </div>
                      </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="No." [flexGrow]="1" [minWidth]="20">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        {{rows.indexOf(row) + 1}}.
                      </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="プロジェクトID" [flexGrow]="1" [minWidth]="140">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        {{row.projectid}}
                      </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="プロジェクト名" [flexGrow]="1" [minWidth]="140">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        {{row.projectname}}
                      </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="プロダクトID" [flexGrow]="1" [minWidth]="140">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        {{row.productid}}
                      </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="プロジェクト詳細" [flexGrow]="1" [minWidth]="200" [cellClass]="'my-custom-cell'">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        {{row.projectsummary}}
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="デバイスグループ数" [flexGrow]="1" [minWidth]="180" [cellClass]="'my-custom-cell'">
                      <ng-template ngx-datatable-cell-template let-row="row">
                          {{row.groupCounts}}
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="デバイス数" [flexGrow]="1" [minWidth]="90" [cellClass]="'my-custom-cell'">
                        <ng-template ngx-datatable-cell-template let-row="row">
                            {{row.deviceCounts}}
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="デバイス連携" [flexGrow]="1" [minWidth]="140" [cellClass]="'my-custom-cell'">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        <a [routerLink]="" class="primary edit mr-1 mrless"
                        (click)="deviceLinkModal(deviceLinkModalContent, row)"><i class="la la-calendar-plus-o"></i>
                      </a>
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="操作" [flexGrow]="1" [minWidth]="100">
                      <ng-template ngx-datatable-cell-template let-row="row">
                        <a [routerLink]="" class="primary edit mr-1 mrless"
                          (click)="editProjectDataModal(editProjectDataModalContent, row)"><i class="la la-pencil"></i>
                        </a>
                        <a class="danger delete mr-1 mrless"><i class="la la-trash-o" (click)="deleteRow(row)"></i></a>
                      </ng-template>
                    </ngx-datatable-column>
                  </ngx-datatable>

                  <div class="row">
                    <div class="col-sm-12 pt-2">
                      <span>1ページに表示されるアイテムの数: </span>
                      <select class="custom-select ml-2" style="width: auto" [(ngModel)]="pageSize">
                        <option [ngValue]="10">10</option>
                        <option [ngValue]="20">20</option>
                        <option [ngValue]="50">50</option>
                        <option [ngValue]="100">100</option>
                      </select>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
<!-- ////////////////////////////////////////////////////////////////////////////-->
<!-- プロジェクト詳細と修正 -->
<ng-template #editProjectDataModalContent let-c="close" let-d="dismiss">
  <form (ngSubmit)="projectDataUpdate(projectEditForm,selectedProject.projectid)" #projectEditForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">プロジェクト詳細</h5>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group col-12">
        <label >プロジェクトID</label>
        <input type="text" [(ngModel)]="selectedProject.projectid" #editname="ngModel" name="projectrowid" id="projectrowid"
          class="name form-control" placeholder="selectedProject.projectid"
           required disabled>
      </div>
      <div class="form-group col-12">
        <label >プロジェクト名</label>
        <input type="text" [(ngModel)]="selectedProject.projectname" #editname="ngModel" name="projectname" id="projectname"
          class="name form-control" placeholder="selectedProject.projectnameame"
           required>
      </div>


      <div class="form-group col-12">
        <label >プロジェクト詳細</label>
        <input type="text" [(ngModel)]="selectedProject.projectsummary"  #editemail="ngModel" name="projectsummary" id="projectsummary"
          class="email form-control" placeholder="selectedProject.projectsummary"
           required>
      </div>


    </div>
    <div class="modal-footer">
      <div class="form-group position-relative has-icon-left mb-0">
        <button type="button" class="btn grey btn-light mr-1"
                            (click)="d('Close modal')" ngbAutofocus>キャンセル</button>
        <button type="submit" id="edit-contact-item" class="btn btn-info edit-contact-item" data-dismiss="modal"><i
            class="la la-paper-plane-o d-lg-none"></i> <span class="d-none d-lg-block">対応完了</span></button>
      </div>
    </div>
  </form>
</ng-template>


<!-- ////////////////////////////////////////////////////////////////////////////-->
<!-- プロジェクト新規追加 -->
<ng-template #addNewProject let-c="close" let-d="dismiss">
  <form (ngSubmit)="addNewProjectForm(NewProjectForm)" #NewProjectForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">プロジェクト新規追加</h5>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      
      <div class="form-group col-12">
        <h6>プロジェクト名</h6>
        <input type="text"  [(ngModel)]="pageModel.addProject.projectName" name="projectName" class="form-control" placeholder="">
      </div>
      <div class="form-group col-12">
        <h6>プロダクトID</h6>
        <input type="text"  [(ngModel)]="pageModel.addProject.productId" name="productId" class="form-control" placeholder="">
      </div>
      <div class="form-group col-12">
        <h6>プロジェクト詳細</h6>
        <input type="text"  [(ngModel)]="pageModel.addProject.projectSummary" name="projectSummary" class="form-control" placeholder="">
      </div>

    </div>
    <div class="modal-footer">
      <div class="form-group position-relative has-icon-left mb-0">
        <button type="button" class="btn grey btn-light mr-1"
                            (click)="d('Close modal')" ngbAutofocus>キャンセル</button>
        <button type="submit" id="edit-contact-item" class="btn btn-info edit-contact-item" data-dismiss="modal"><i
            class="la la-paper-plane-o d-lg-none"></i> <span class="d-none d-lg-block">登録</span></button>
      </div>
    </div>
  </form>
</ng-template>



<!-- ////////////////////////////////////////////////////////////////////////////-->
<!-- プロジェクトのデバイス連携 -->
<ng-template #deviceLinkModalContent let-c="close" let-d="dismiss">
  <form (ngSubmit)="addNewContact(addForm)" #addForm="ngForm">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel1">デバイス連携</h5>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">

      <div class="table-responsive form-group col-12">
        <table id="list-table" class="table table-hover table-bordered" cellspacing="0">
          <thead>
            <tr>
              <th scope="col">no.</th>
              <th scope="col">projectid</th>
              <th scope="col">groupId</th>
              <th scope="col">deviceName</th>
              <th scope="col">imei</th>
              <th scope="col">iccid</th>
              <th scope="col">sn</th>
              <th scope="col">sim_iccid</th>
              <th scope="col">sim_imsi</th>
              <th scope="col">sim_tel</th>
              <th scope="col">encryptedCommunications</th>
              <th scope="col">encryptedKey</th>
              <th scope="col">connectServerURL</th>
              <th scope="col">connectServerPort</th>
              <th scope="col">bindingFlag</th>
              <th scope="col">fmLastestVersion</th>
              <th scope="col">versionComfirmTime</th>
              <th scope="col">productId</th>
              <th scope="col">companyId</th>
              <th scope="col">userId</th>
              <th scope="col">lastProjectId</th>
              <th scope="col">lastGroupId</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of rows; let i = index;">
              <td data-label="no.">{{i + 1}}</td>
              <td data-label="projectid">{{item.projectid}}</td>
              <td data-label="groupId">{{item.groupid}}</td>
              <td data-label="deviceName">{{item.devicename}}</td>
              <td data-label="imei">{{item.imei}}</td>
              <td data-label="iccid">{{item.iccid}}</td>
              <td data-label="sn">{{item.sn}}</td>
              <td data-label="sim_iccid">{{item.sim_iccid}}</td>
              <td data-label="sim_imsi">{{item.sim_imsi}}</td>
              <td data-label="sim_tel">{{item.sim_tel}}</td>
              <td data-label="encryptedCommunications">{{item.encryptedcommunications}}</td>
              <td data-label="encryptedKey">{{item.encryptedkey}}</td>
              <td data-label="connectServerURL">{{item.connectserverurl}}</td>
              <td data-label="connectServerPort">{{item.connectserverport}}</td>
              <td data-label="bindingFlag">{{item.bindingflag}}</td>
              <td data-label="fmLastestVersion">{{item.fmlastestversion}}</td>
              <td data-label="versionComfirmTime">{{item.versioncomfirmtime}}</td>
              <td data-label="productId">{{item.productid}}</td>
              <td data-label="companyId">{{item.companyid}}</td>
              <!-- <td data-label="industry">{{item.industry}}</td> -->
              <td data-label="userId">{{item.userid}}</td>
              <td data-label="lastProjectId">{{item.lastprojectId}}</td>
              <td data-label="lastGroupId">{{item.lastgroupid}}</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      
      
      
    </div>
    <div class="modal-footer">
      <div class="form-group position-relative has-icon-left mb-0">
        <button type="submit" id="add-contact-item" class="btn btn-info add-contact-item"><i
            class="la la-paper-plane-o d-lg-none"></i> <span class="d-none d-lg-block">Add
            New</span></button>
      </div>
    </div>
  </form>
</ng-template>



